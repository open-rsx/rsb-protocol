CMAKE_MINIMUM_REQUIRED(VERSION 2.6)

# Name and version
PROJECT("RSBProtocol")

SET(RSB_PROTOCOL_VERSION_MAJOR "0")
SET(RSB_PROTOCOL_VERSION_MINOR "4")
SET(RSB_PROTOCOL_VERSION_PATCH "0")
SET(RSB_PROTOCOL_VERSION "${RSB_PROTOCOL_VERSION_MAJOR}.${RSB_PROTOCOL_VERSION_MINOR}.${RSB_PROTOCOL_VERSION_PATCH}")
SET(RSB_PROTOCOL_WIRE_FORMAT_VERSION "5")

SET(CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS TRUE)

MACRO(INSTALL_FILES_WITH_DIRECTORY FILE_LIST)

    FOREACH(HEADER ${${FILE_LIST}})
        STRING(REGEX MATCH "(.*)[/\\]" DIR ${HEADER})
        INSTALL(FILES ${HEADER} DESTINATION share/${DIR})
    ENDFOREACH(HEADER)

ENDMACRO()

MATH(EXPR WIRE_FORMAT_VERSION_FIELD_NUMBER
     "100 + ${RSB_PROTOCOL_WIRE_FORMAT_VERSION}")
CONFIGURE_FILE(RSBProtocol/Protocol.proto.in
               "${CMAKE_CURRENT_SOURCE_DIR}/RSBProtocol/Protocol.proto"
	       @ONLY)

SET(PROTOFILES RSBProtocol/Protocol.proto
               RSBProtocol/introspection/PortStateChange.proto)

INSTALL_FILES_WITH_DIRECTORY(PROTOFILES)

CONFIGURE_FILE(RSBProtocolConfig.cmake.in
               ${CMAKE_CURRENT_BINARY_DIR}/RSBProtocolConfig.cmake
	       @ONLY)
CONFIGURE_FILE(RSBProtocolConfig-version.cmake.in
               ${CMAKE_CURRENT_BINARY_DIR}/RSBProtocolConfig-version.cmake
	       @ONLY)
INSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/RSBProtocolConfig.cmake
              ${CMAKE_CURRENT_BINARY_DIR}/RSBProtocolConfig-version.cmake
        DESTINATION share/RSBProtocol)

# Package
SET(CPACK_PACKAGE_VENDOR "CoR-Lab Bielefeld University")
SET(CPACK_PACKAGE_VERSION_MAJOR ${RSB_PROTOCOL_VERSION_MAJOR})
SET(CPACK_PACKAGE_VERSION_MINOR ${RSB_PROTOCOL_VERSION_MINOR})
SET(CPACK_PACKAGE_VERSION_PATCH ${RSB_PROTOCOL_VERSION_PATCH})
SET(CPACK_RESOURCE_FILE_LICENSE "${CMAKE_CURRENT_SOURCE_DIR}/COPYING")

INCLUDE(CPack)
