CMAKE_MINIMUM_REQUIRED(VERSION 2.6)

# Name and version
PROJECT("RSBProtocol")

SET(RSB_PROTOCOL_VERSION_MAJOR "0")
SET(RSB_PROTOCOL_VERSION_MINOR "5")
SET(RSB_PROTOCOL_VERSION_PATCH "0")
SET(RSB_PROTOCOL_VERSION "${RSB_PROTOCOL_VERSION_MAJOR}.${RSB_PROTOCOL_VERSION_MINOR}.${RSB_PROTOCOL_VERSION_PATCH}")
SET(RSB_PROTOCOL_WIRE_FORMAT_VERSION "6")

SET(CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS TRUE)

MATH(EXPR WIRE_FORMAT_VERSION_FIELD_NUMBER
     "100 + ${RSB_PROTOCOL_WIRE_FORMAT_VERSION}")
CONFIGURE_FILE(rsbprotocol/Protocol.proto.in
               "${CMAKE_CURRENT_BINARY_DIR}/rsbprotocol/Protocol.proto"
               @ONLY)

INSTALL(FILES "${CMAKE_CURRENT_BINARY_DIR}/rsbprotocol/Protocol.proto" DESTINATION share/rsbprotocol)
INSTALL(FILES "rsbprotocol/introspection/PortStateChange.proto" DESTINATION share/rsbprotocol/introspection)

SET(PROTOFILES rsbprotocol/Protocol.proto
               rsbprotocol/introspection/PortStateChange.proto)
CONFIGURE_FILE(RSBProtocolConfig.cmake.in
               ${CMAKE_CURRENT_BINARY_DIR}/RSBProtocolConfig.cmake
               @ONLY)
CONFIGURE_FILE(RSBProtocolConfig-version.cmake.in
               ${CMAKE_CURRENT_BINARY_DIR}/RSBProtocolConfig-version.cmake
               @ONLY)
INSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/RSBProtocolConfig.cmake
              ${CMAKE_CURRENT_BINARY_DIR}/RSBProtocolConfig-version.cmake
        DESTINATION share/rsbprotocol)

# Package
SET(CPACK_PACKAGE_VENDOR "CoR-Lab Bielefeld University")
SET(CPACK_PACKAGE_VERSION_MAJOR ${RSB_PROTOCOL_VERSION_MAJOR})
SET(CPACK_PACKAGE_VERSION_MINOR ${RSB_PROTOCOL_VERSION_MINOR})
SET(CPACK_PACKAGE_VERSION_PATCH ${RSB_PROTOCOL_VERSION_PATCH})
SET(CPACK_RESOURCE_FILE_LICENSE "${CMAKE_CURRENT_SOURCE_DIR}/COPYING.txt")

SET(CPACK_DEBIAN_PACKAGE_NAME "rsbprotocol")
SET (${RSB_PROTOCOL_VERSION_MAJOR}.${RSB_PROTOCOL_VERSION_MINOR} CPACK_DEBIAN_PACKAGE_VERSION)
SET (CPACK_DEBIAN_PACKAGE_MAINTAINER "Sebastian Wrede (swrede@techfak.uni-bielefeld.de)")
SET (CPACK_DEBIAN_PACKAGE_DESCRIPTION "RSB Protocol Definitions")
SET (CPACK_DEBIAN_PACKAGE_PRIORITY "optional")
SET (CPACK_DEBIAN_PACKAGE_SECTION "devel")
SET (CPACK_DEBIAN_ARCHITECTURE ${CMAKE_SYSTEM_PROCESSOR})
SET (CPACK_DEBIAN_PACKAGE_DEPENDS "libc6-i686, libprotoc-dev, libprotobuf5, protobuf-compiler, rsc")

INCLUDE(CPack)
